<!DOCTYPE html> <html lang="en"> <head> <meta http-equiv="Content-Type" content="text/html; charset=UTF-8"> <meta charset="utf-8"> <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"> <meta http-equiv="X-UA-Compatible" content="IE=edge"> <title> KNRM | Rastko Gajanin </title> <meta name="author" content="Rastko Gajanin"> <meta name="description" content="Implementation of Kernel-based Neural Re-Ranking Model"> <meta name="keywords" content="jekyll, jekyll-theme, academic-website, portfolio-website"> <link rel="stylesheet" href="/assets/css/bootstrap.min.css?a4b3f509e79c54a512b890d73235ef04"> <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/mdbootstrap@4.20.0/css/mdb.min.css" integrity="sha256-jpjYvU3G3N6nrrBwXJoVEYI/0zw8htfFnhT9ljN3JJw=" crossorigin="anonymous"> <link defer rel="stylesheet" href="/assets/css/academicons.min.css?f0b7046b84e425c55f3463ac249818f5"> <link defer rel="stylesheet" type="text/css" href="https://fonts.googleapis.com/css?family=Roboto:300,400,500,700|Roboto+Slab:100,300,400,500,700|Material+Icons&amp;display=swap"> <link defer rel="stylesheet" href="/assets/css/jekyll-pygments-themes-github.css?591dab5a4e56573bf4ef7fd332894c99" media="" id="highlight_theme_light"> <link rel="shortcut icon" href="data:image/svg+xml,&lt;svg%20xmlns=%22http://www.w3.org/2000/svg%22%20viewBox=%220%200%20100%20100%22&gt;&lt;text%20y=%22.9em%22%20font-size=%2290%22&gt;%E2%9A%9B%EF%B8%8F&lt;/text&gt;&lt;/svg&gt;"> <link rel="stylesheet" href="/assets/css/main.css?d41d8cd98f00b204e9800998ecf8427e"> <link rel="canonical" href="https://r-gg.github.io/projects/adv_inf_retr/"> <script src="/assets/js/theme.js?a5ca4084d3b81624bcfa01156dae2b8e"></script> <link defer rel="stylesheet" href="/assets/css/jekyll-pygments-themes-native.css?5847e5ed4a4568527aa6cfab446049ca" media="none" id="highlight_theme_dark"> <script>initTheme();</script> </head> <body class="fixed-top-nav "> <header> <nav id="navbar" class="navbar navbar-light navbar-expand-sm fixed-top" role="navigation"> <div class="container"> <a class="navbar-brand title font-weight-lighter" href="/"> Rastko Gajanin </a> <button class="navbar-toggler collapsed ml-auto" type="button" data-toggle="collapse" data-target="#navbarNav" aria-controls="navbarNav" aria-expanded="false" aria-label="Toggle navigation"> <span class="sr-only">Toggle navigation</span> <span class="icon-bar top-bar"></span> <span class="icon-bar middle-bar"></span> <span class="icon-bar bottom-bar"></span> </button> <div class="collapse navbar-collapse text-right" id="navbarNav"> <ul class="navbar-nav ml-auto flex-nowrap"> <li class="nav-item "> <a class="nav-link" href="/">about </a> </li> <li class="nav-item "> <a class="nav-link" href="/publications/">publications </a> </li> <li class="nav-item active"> <a class="nav-link" href="/projects/">projects <span class="sr-only">(current)</span> </a> </li> <li class="nav-item "> <a class="nav-link" href="/repositories/">repositories </a> </li> <li class="nav-item "> <a class="nav-link" href="/cv/">cv </a> </li> <li class="toggle-container"> <button id="light-toggle" title="Change theme"> <i class="ti ti-sun-moon" id="light-toggle-system"></i> <i class="ti ti-moon-filled" id="light-toggle-dark"></i> <i class="ti ti-sun-filled" id="light-toggle-light"></i> </button> </li> </ul> </div> </div> </nav> <progress id="progress" value="0"> <div class="progress-container"> <span class="progress-bar"></span> </div> </progress> </header> <div class="container mt-5" role="main"> <div class="post"> <header class="post-header"> <h1 class="post-title">KNRM</h1> <p class="post-description">Implementation of Kernel-based Neural Re-Ranking Model</p> </header> <article> <p><strong>Development Period:</strong> <em>05.2023 - 06.2023</em></p> <p><strong>Keywords:</strong> <em>information retrieval, neural IR, neural re-ranking, embedding, kernel pooling, pytorch</em></p> <p>Over the course Advanced Information Retrieval I implemented the <strong>Kernel-based neural re-ranking model (KNRM)</strong> as presented by <a href="https://dl.acm.org/doi/abs/10.1145/3077136.3080809" rel="external nofollow noopener" target="_blank">Xiong et al.</a></p> <blockquote> <p>Due to privacy regulations, the repository could not have been made public. Code upon request.</p> </blockquote> <div class="row"> <div class="col-sm mt-3 mt-md-0"> <figure> <picture> <source class="responsive-img-srcset" srcset="/assets/img/adv_ir/knrm-480.webp 480w,/assets/img/adv_ir/knrm-800.webp 800w,/assets/img/adv_ir/knrm-1400.webp 1400w," sizes="95vw" type="image/webp"></source> <img src="/assets/img/adv_ir/knrm.png" class="img-fluid rounded z-depth-1" width="100%" height="auto" title="KNRM Architecture" loading="eager" onerror="this.onerror=null; $('.responsive-img-srcset').remove();"> </picture> </figure> </div> </div> <div class="caption"> The Architecture of K-NRM. Given input query words and document words, the embedding layer maps them into distributed representations, the translation layer calculates the word-word similarities and forms the trans- lation matrix, the kernel pooling layer generate soft-TF counts as ranking features, and the learning to rank layer combines the soft-TF to the final ranking score. Source:<a href="https://dl.acm.org/doi/abs/10.1145/3077136.3080809" rel="external nofollow noopener" target="_blank">Xiong et al.</a> </div> <h2 id="implementation">Implementation</h2> <p>In the <code class="language-plaintext highlighter-rouge">init</code> method of the model, the Weights and Biases of the MLP part are initialized along with the word embeddings and the (gaussian) kernel statistics (mean and standard deviation).</p> <p>The forward pass was adapted from the original implementation which is written with TensorFlow. Hence we adapted it to use Torch instead.</p> <p>In the following the procedure is briefly described:</p> <ol> <li>we firstly calculate the word embeddings for the query and the document as well as the query and document OOV masks.</li> <li>query and document embeddings are then normalized and based on their normalized versions, the similarity matrix is computed</li> <li>for each kernel, the similarity matrix is fed into the kernel function and the output is summed up over the document dimension</li> <li>words which are OOV are masked out</li> <li>the sum over the query dimension is build along with the query-term weighting</li> <li>the summed up values are then fed into the MLP (tanh(m * W + b)) and the output is returned</li> </ol> <p>There were not that many problems with translating the code from tensorflow to torch. However, in order to do it one had to really understand how the algorithm works.</p> <h3 id="hyperparameter-tuning">Hyperparameter tuning</h3> <p>We’ve spent a reasonable amount of time on hyperparameter tuning. We wanted to implement it with Ray tune at first, but we’ve encountered some problems (probably related to python version), hence we switched to optuna. With optuna we only tuned the value of the learning rate and this is extensible to the batch size and other model parameters as well.</p> <p>With hyperparam tuner we aim to maximize MRR@10. Other possibilities were maximizing the NDCG or MAP@k. Hyperparameter tuning was performed with only a subset of the whole data:</p> <ul> <li>For training data, 1000 out of 2.4 mil</li> <li>For validation data we use all tuples</li> </ul> <p>In total, 10 trials were executed in order to find the best learning rate. Each one had 2 epochs.</p> <p>We of course set the seed to 1 for the optuna sampler to make the results reproducible.</p> <p>The best learning rate found through these trials was:</p> <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code> {'learning_rate': 0.00024112537061475754}
</code></pre></div></div> <h3 id="training-and-evaluation">Training and evaluation</h3> <p>In the validation and test .tsv files we are presented with a query and the top 40 relevant documents ranked by BM25. We have to re-rank these documents using our neural model and then evaluate the results using the msmarco qrels file, our fira aggregated judgements and the fira baseline judgements.</p> <p>Due to slow training we have decided to reduce the training set size to 1/10 of the original set which is still plenty of samples (<code class="language-plaintext highlighter-rouge">240000</code>). Additionally we trained the model in two epochs.</p> <p>Metrics used for evaluation with the MSMARCO test set were MRR@10 and NDCG@10.</p> <h4 id="final-results-on-the-msmarco-test-set">Final results on the MSMARCO test set</h4> <ul> <li><strong>MRR@10 0.1924</strong></li> <li><strong>NDCG@10 0.2459</strong></li> </ul> </article> </div> </div> <footer class="fixed-bottom" role="contentinfo"> <div class="container mt-0"> © Copyright 2024 Rastko Gajanin. Powered by <a href="https://jekyllrb.com/" target="_blank" rel="external nofollow noopener">Jekyll</a> with <a href="https://github.com/alshedivat/al-folio" rel="external nofollow noopener" target="_blank">al-folio</a> theme. Hosted by <a href="https://pages.github.com/" target="_blank" rel="external nofollow noopener">GitHub Pages</a>. Photos from <a href="https://unsplash.com" target="_blank" rel="external nofollow noopener">Unsplash</a>. Last updated: May 03, 2024. </div> </footer> <script src="https://cdn.jsdelivr.net/npm/jquery@3.6.0/dist/jquery.min.js" integrity="sha256-/xUj+3OJU5yExlq6GSYGSHk7tPXikynS7ogEvDej/m4=" crossorigin="anonymous"></script> <script src="/assets/js/bootstrap.bundle.min.js"></script> <script src="https://cdn.jsdelivr.net/npm/mdbootstrap@4.20.0/js/mdb.min.js" integrity="sha256-NdbiivsvWt7VYCt6hYNT3h/th9vSTL4EDWeGs5SN3DA=" crossorigin="anonymous"></script> <script defer src="https://cdn.jsdelivr.net/npm/masonry-layout@4.2.2/dist/masonry.pkgd.min.js" integrity="sha256-Nn1q/fx0H7SNLZMQ5Hw5JLaTRZp0yILA/FRexe19VdI=" crossorigin="anonymous"></script> <script defer src="https://cdn.jsdelivr.net/npm/imagesloaded@5.0.0/imagesloaded.pkgd.min.js" integrity="sha256-htrLFfZJ6v5udOG+3kNLINIKh2gvoKqwEhHYfTTMICc=" crossorigin="anonymous"></script> <script defer src="/assets/js/masonry.js" type="text/javascript"></script> <script defer src="https://cdn.jsdelivr.net/npm/medium-zoom@1.1.0/dist/medium-zoom.min.js" integrity="sha256-ZgMyDAIYDYGxbcpJcfUnYwNevG/xi9OHKaR/8GK+jWc=" crossorigin="anonymous"></script> <script defer src="/assets/js/zoom.js?85ddb88934d28b74e78031fd54cf8308"></script> <script src="/assets/js/no_defer.js?2781658a0a2b13ed609542042a859126"></script> <script defer src="/assets/js/common.js?b7816bd189846d29eded8745f9c4cf77"></script> <script defer src="/assets/js/copy_code.js?12775fdf7f95e901d7119054556e495f" type="text/javascript"></script> <script defer src="/assets/js/jupyter_new_tab.js?d9f17b6adc2311cbabd747f4538bb15f"></script> <script type="text/javascript">window.MathJax={tex:{tags:"ams"}};</script> <script defer type="text/javascript" id="MathJax-script" src="https://cdn.jsdelivr.net/npm/mathjax@3.2.0/es5/tex-mml-chtml.min.js"></script> <script defer src="https://cdnjs.cloudflare.com/polyfill/v3/polyfill.min.js?features=es6"></script> <script type="text/javascript">function progressBarSetup(){"max"in document.createElement("progress")?(initializeProgressElement(),$(document).on("scroll",function(){progressBar.attr({value:getCurrentScrollPosition()})}),$(window).on("resize",initializeProgressElement)):(resizeProgressBar(),$(document).on("scroll",resizeProgressBar),$(window).on("resize",resizeProgressBar))}function getCurrentScrollPosition(){return $(window).scrollTop()}function initializeProgressElement(){let e=$("#navbar").outerHeight(!0);$("body").css({"padding-top":e}),$("progress-container").css({"padding-top":e}),progressBar.css({top:e}),progressBar.attr({max:getDistanceToScroll(),value:getCurrentScrollPosition()})}function getDistanceToScroll(){return $(document).height()-$(window).height()}function resizeProgressBar(){progressBar.css({width:getWidthPercentage()+"%"})}function getWidthPercentage(){return getCurrentScrollPosition()/getDistanceToScroll()*100}const progressBar=$("#progress");window.onload=function(){setTimeout(progressBarSetup,50)};</script> </body> </html>